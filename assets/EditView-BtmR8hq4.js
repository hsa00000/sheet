import{u as A,a as B,h as j,i as C}from"./computeHeader-DTrwE69O.js";import{d as D,r as w,u as $,a as R,c as T,w as h,b as z,e as n,f as a,g as s,F as H,o as M,h as l,i as q,j as b,t as G,s as J,P as K,_ as Q}from"./index-DzLluilh.js";const W={class:"d-flex flex-row justify-center ga-1"},X=D({__name:"EditView",setup(Y){const y=A(),x=w(1),m=B(),o=$(),S=R(),_=w(""),L=T(()=>[...j.value,{title:"操作",key:"actions",align:"center",width:"100px",sortable:!1}]),P=d=>{const t=o.combinedList.findIndex(i=>i===d);t!==-1&&o.deleteByCombinedIndex(t)},I=d=>{const i=o.combinedList.findIndex(p=>p===d)-o.outsider.length;i>=0&&o.moveUpInParticipantList(i),console.log("participantStore.combinedList is",o.combinedList)},F=d=>{const i=o.combinedList.findIndex(p=>p===d)-o.outsider.length;i>=0&&o.moveDownInParticipantList(i)},N=()=>{const d=_.value.trim();if(!d)return;o.outsider.some(i=>i.name===d)||(o.outsider.push({id:"",department:"校外人士",name:d,food:"無須用餐"}),_.value="")},g=w(null);return h(g,async d=>{if(!d)return;const t=new FileReader;t.onload=async()=>{const i=new Uint8Array(t.result),V=new TextDecoder("big5").decode(i);await J("lastCsvFile",V);const f=K.parse(V,{header:!0,skipEmptyLines:!0});o.participantList=f.data.map(r=>{const c=Object.fromEntries(Object.entries(r).map(([v,U])=>[v.trim(),U]));return{id:String(c["職工/學號"]??""),department:String(c.單位??""),name:String(c.參加者??""),food:String(c.提供用餐??"")}})},t.readAsArrayBuffer(d)}),(d,t)=>{const i=s("v-checkbox-btn"),p=s("v-list-item-action"),V=s("v-list-item"),f=s("v-col"),r=s("v-text-field"),c=s("v-card-text"),v=s("v-btn"),U=s("v-data-table"),k=s("v-card"),E=s("v-file-input"),O=s("v-number-input");return M(),z(H,null,[n(f,{cols:"3"},{default:a(()=>[n(V,null,{prepend:a(()=>[n(p,{start:""},{default:a(()=>[n(i,{modelValue:l(S).enableFood,"onUpdate:modelValue":t[0]||(t[0]=e=>l(S).enableFood=e),label:"用餐"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),n(f,{cols:"6"},{default:a(()=>[n(k,null,{default:a(()=>[n(k,{class:"print-page"},{default:a(()=>[n(c,null,{default:a(()=>[n(r,{modelValue:l(m).name,"onUpdate:modelValue":t[1]||(t[1]=e=>l(m).name=e),label:"活動名稱",variant:"underlined",dense:""},null,8,["modelValue"]),n(r,{modelValue:l(m).period,"onUpdate:modelValue":t[2]||(t[2]=e=>l(m).period=e),label:"活動日期",variant:"underlined",dense:""},null,8,["modelValue"]),n(r,{modelValue:l(m).location,"onUpdate:modelValue":t[3]||(t[3]=e=>l(m).location=e),label:"活動地點",variant:"underlined",dense:""},null,8,["modelValue"])]),_:1}),n(U,{headers:L.value,items:l(o).combinedList,page:x.value,"onUpdate:page":t[4]||(t[4]=e=>x.value=e),class:"print-table row-height-26 text-center text-black","items-per-page":l(C),"no-data-text":"請先選擇 csv 檔","items-per-page-text":"每頁顯示數量"},{"item.index":a(({index:e})=>[b(G((x.value-1)*l(C)+e+1),1)]),"item.id":a(({item:e})=>[n(r,{modelValue:e.id,"onUpdate:modelValue":u=>e.id=u,"hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),"item.department":a(({item:e})=>[n(r,{modelValue:e.department,"onUpdate:modelValue":u=>e.department=u,"hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),"item.name":a(({item:e})=>[n(r,{modelValue:e.name,"onUpdate:modelValue":u=>e.name=u,"hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),"item.food":a(({item:e})=>[n(r,{modelValue:e.food,"onUpdate:modelValue":u=>e.food=u,"hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),"item.actions":a(({item:e})=>[q("div",W,[n(v,{variant:"outlined",onClick:u=>P(e)},{default:a(()=>t[8]||(t[8]=[b("刪除")])),_:2},1032,["onClick"]),n(v,{variant:"outlined",onClick:u=>I(e),disabled:l(o).isOutsider(e)},{default:a(()=>t[9]||(t[9]=[b(" 上移 ")])),_:2},1032,["onClick","disabled"]),n(v,{variant:"outlined",onClick:u=>F(e),disabled:l(o).isOutsider(e)},{default:a(()=>t[10]||(t[10]=[b(" 下移 ")])),_:2},1032,["onClick","disabled"])])]),_:2},1032,["headers","items","page","items-per-page"])]),_:1})]),_:1})]),_:1}),n(f,{cols:"3"},{default:a(()=>[n(E,{"prepend-icon":"","append-inner-icon":"mdi-paperclip",modelValue:g.value,"onUpdate:modelValue":t[5]||(t[5]=e=>g.value=e),label:"選擇 CSV 檔",accept:".csv","show-size":""},null,8,["modelValue"]),n(r,{modelValue:_.value,"onUpdate:modelValue":t[6]||(t[6]=e=>_.value=e),label:"新增校外人士","hide-details":"",class:"mb-5"},{"append-inner":a(()=>[n(v,{variant:"text",onClick:N,disabled:!_.value},{default:a(()=>t[11]||(t[11]=[b(" 新增 ")])),_:1},8,["disabled"])]),_:1},8,["modelValue"]),n(O,{modelValue:l(y).emptyPageNumber,"onUpdate:modelValue":t[7]||(t[7]=e=>l(y).emptyPageNumber=e),label:"額外空白簽到頁數",min:0,step:1,"control-variant":"default","hide-details":""},null,8,["modelValue"])]),_:1})],64)}}}),te=Q(X,[["__scopeId","data-v-1d378df9"]]);export{te as default};
